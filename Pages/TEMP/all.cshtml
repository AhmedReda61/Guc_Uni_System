@page
@model Guc_Uni_System.Pages.allModel
@{
    ViewData["Title"] = "All Database Data";
}

<div class="container-fluid mt-4">
    <h2 class="mb-4">Database Content Viewer</h2>
    <p class="text-muted">Click on a section header to expand/collapse the table.</p>

    <div class="accordion" id="dbAccordion">

        <!-- 1. EMPLOYEES -->
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingEmp">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseEmp" aria-expanded="true" aria-controls="collapseEmp">
                    Employees (@Model.employees.Count records)
                </button>
            </h2>
            <div id="collapseEmp" class="accordion-collapse collapse show" aria-labelledby="headingEmp" data-bs-parent="#dbAccordion">
                <div class="accordion-body table-responsive">
                    <table class="table table-sm table-striped table-hover">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Password</th>
                                <th>Address</th>
                                <th>Dept</th>
                                <th>Roles</th>
                                <th>Job Type</th>
                                <th>Status</th>
                                <th>Balance (Ann/Acc)</th>
                                <th>dayoff</th>
                                <th>Experience</th>
                                <th>Salary</th>

                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model.employees)
                            {
                                <tr>
                                    <td>@item.EmployeeId</td>
                                    <td>@item.FirstName @item.LastName</td>
                                    <td>@item.Email</td>
                                    <td>@item.Password</td>
                                    <td>@item.Address</td>
                                    <td>@item.DeptName</td>
                                    <!-- NEW COLUMN FOR ROLES -->
                                    <td>
                                        @if (item.RoleNames != null && item.RoleNames.Any())
                                        {
                                            <!-- Joins all roles with a comma: "Dean, Lecturer" -->
                                            <span class="badge bg-secondary">
                                                @string.Join(", ", item.RoleNames.Select(r => r.RoleName))
                                            </span>
                                        }
                                        else
                                        {
                                            <span class="text-muted small">None</span>
                                        }
                                    </td>
                                    <td>@item.TypeOfContract</td>
                                    <td>@item.EmploymentStatus</td>
                                    <td>@item.AnnualBalance / @item.AccidentalBalance</td>
                                    <td>@item.OfficialDayOff</td>
                                    <td>@item.YearsOfExperience</td>
                                    <td>@item.Salary</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- 2. DEPARTMENTS (View: NoEmployeeDept) -->
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingDept">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseDept">
                    Departments Stats (@Model.deps.Count records)
                </button>
            </h2>
            <div id="collapseDept" class="accordion-collapse collapse" aria-labelledby="headingDept" data-bs-parent="#dbAccordion">
                <div class="accordion-body">
                    <table class="table table-sm table-striped">
                        <thead>
                            <tr>
                                <th>Department Name</th>
                                <th>Number of Employees</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model.deps)
                            {
                                <tr>
                                    <!-- Property names based on SQL View columns -->
                                    <td>@item.Department</td>
                                    <td>@item.NumberOfEmployees</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- 3. ROLES -->
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingRoles">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseRoles">
                    Roles (@Model.roles.Count records)
                </button>
            </h2>
            <div id="collapseRoles" class="accordion-collapse collapse" aria-labelledby="headingRoles" data-bs-parent="#dbAccordion">
                <div class="accordion-body">
                    <table class="table table-sm table-striped">
                        <thead>
                            <tr>
                                <th>Role Name</th>
                                <th>Title</th>
                                <th>Rank</th>
                                <th>Base Salary</th>
                                <th>% YOE</th>
                                <th>% Overtime</th>
                                <th>annual balance</th>
                                <th>accidental balance</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model.roles)
                            {
                                <tr>
                                    <td>@item.RoleName</td>
                                    <td>@item.Title</td>
                                    <td>@item.Rank</td>
                                    <td>@item.BaseSalary</td>
                                    <td>@item.PercentageYoe</td>
                                    <td>@item.PercentageOvertime</td>
                                    <td>@item.AnnualBalance</td>
                                    <td>@item.AccidentalBalance</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- 4. ATTENDANCE -->
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingAtt">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseAtt">
                    Attendance (@Model.attendances.Count records)
                </button>
            </h2>
            <div id="collapseAtt" class="accordion-collapse collapse" aria-labelledby="headingAtt" data-bs-parent="#dbAccordion">
                <div class="accordion-body table-responsive">
                    <table class="table table-sm table-striped">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Date</th>
                                <th>Emp ID</th>
                                <th>In</th>
                                <th>Out</th>
                                <th>Duration</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model.attendances)
                            {
                                <tr>
                                    <td>@item.AttendanceId</td>
                                    <td>@item.Date</td> <!-- .ToShortDateString() if needed -->
                                    <td>@item.EmpId</td>
                                    <td>@item.CheckInTime</td>
                                    <td>@item.CheckOutTime</td>
                                    <td>@item.TotalDuration</td>
                                    <td>@item.Status</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- 5. LEAVES (Grouped) -->
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingLeaves">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseLeaves">
                    All Leave Requests
                </button>
            </h2>
            <div id="collapseLeaves" class="accordion-collapse collapse" aria-labelledby="headingLeaves" data-bs-parent="#dbAccordion">
                <div class="accordion-body">

                    <!-- Annual -->
                    <h5 class="text-primary mt-3">Annual Leaves</h5>
                    <table class="table table-sm table-bordered mb-4">
                        <thead class="table-light">
                            <tr>
                                <th>Req ID</th>
                                <th>Emp ID</th>
                                <th>Replacement</th>
                                <th>Start Date</th>
                                <th>End Date</th>
                                <th>Days</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var l in Model.ann_leaves)
                            {
                                <tr>
                                    <td>@l.RequestId</td>
                                    <td>@l.EmpId</td>
                                    <td>@l.ReplacementEmp</td>
                                    <!-- Parent Table Data -->
                                    <td>@l.Request.StartDate?.ToShortDateString()</td>
                                    <td>@l.Request.EndDate?.ToShortDateString()</td>
                                    <td>@l.Request.NumDays</td>
                                    <td><span class="badge bg-info text-dark">@l.Request.FinalApprovalStatus</span></td>
                                </tr>
                            }
                        </tbody>
                    </table>

                    <!-- Accidental -->
                    <h5 class="text-warning mt-3">Accidental Leaves</h5>
                    <table class="table table-sm table-bordered mb-4">
                        <thead class="table-light">
                            <tr>
                                <th>Req ID</th>
                                <th>Emp ID</th>
                                <th>Start Date</th>
                                <th>End Date</th>
                                <th>Days</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var l in Model.acc_leaves)
                            {
                                <tr>
                                    <td>@l.RequestId</td>
                                    <td>@l.EmpId</td>
                                    <!-- Parent Table Data -->
                                    <td>@l.Request.StartDate?.ToShortDateString()</td>
                                    <td>@l.Request.EndDate?.ToShortDateString()</td>
                                    <td>@l.Request.NumDays</td>
                                    <td><span class="badge bg-info text-dark">@l.Request.FinalApprovalStatus</span></td>
                                </tr>
                            }
                        </tbody>
                    </table>

                    <!-- Medical -->
                    <h5 class="text-danger mt-3">Medical Leaves</h5>
                    <table class="table table-sm table-bordered mb-4">
                        <thead class="table-light">
                            <tr>
                                <th>Req ID</th>
                                <th>Emp ID</th>
                                <th>Type</th>
                                <th>Details</th>
                                <th>Insurance</th>
                                <th>Start Date</th>
                                <th>End Date</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var l in Model.medicals_leaves)
                            {
                                <tr>
                                    <td>@l.RequestId</td>
                                    <td>@l.EmpId</td>
                                    <td>@l.Type</td>
                                    <td>@l.DisabilityDetails</td>
                                    <td>@l.InsuranceStatus</td>
                                    <!-- Parent Table Data -->
                                    <td>@l.Request.StartDate?.ToShortDateString()</td>
                                    <td>@l.Request.EndDate?.ToShortDateString()</td>
                                    <td><span class="badge bg-info text-dark">@l.Request.FinalApprovalStatus</span></td>
                                </tr>
                            }
                        </tbody>
                    </table>

                    <!-- Unpaid -->
                    <h5 class="text-secondary mt-3">Unpaid Leaves</h5>
                    <table class="table table-sm table-bordered mb-4">
                        <thead class="table-light">
                            <tr>
                                <th>Req ID</th>
                                <th>Emp ID</th>
                                <th>Start Date</th>
                                <th>End Date</th>
                                <th>Days</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var l in Model.unpaid_leaves)
                            {
                                <tr>
                                    <td>@l.RequestId</td>
                                    <td>@l.EmpId</td>
                                    <!-- Parent Table Data -->
                                    <td>@l.Request.StartDate?.ToShortDateString()</td>
                                    <td>@l.Request.EndDate?.ToShortDateString()</td>
                                    <td>@l.Request.NumDays</td>
                                    <td><span class="badge bg-info text-dark">@l.Request.FinalApprovalStatus</span></td>
                                </tr>
                            }
                        </tbody>
                    </table>

                    <!-- Compensation -->
                    <h5 class="text-success mt-3">Compensation Leaves</h5>
                    <table class="table table-sm table-bordered mb-4">
                        <thead class="table-light">
                            <tr>
                                <th>Req ID</th>
                                <th>Emp ID</th>
                                <th>Reason</th>
                                <th>Original Work Date</th>
                                <th>Leave Date</th> <!-- Usually Start Date -->
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var l in Model.comp_leaves)
                            {
                                <tr>
                                    <td>@l.RequestId</td>
                                    <td>@l.EmpId</td>
                                    <td>@l.Reason</td>
                                    <td>@l.DateOfOriginalWorkday?.ToShortDateString()</td>
                                    <!-- Parent Table Data -->
                                    <td>@l.Request.StartDate?.ToShortDateString()</td>
                                    <td><span class="badge bg-info text-dark">@l.Request.FinalApprovalStatus</span></td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- 6. PAYROLL & DEDUCTIONS -->
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingPay">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapsePay">
                    Payroll & Deductions
                </button>
            </h2>
            <div id="collapsePay" class="accordion-collapse collapse" aria-labelledby="headingPay" data-bs-parent="#dbAccordion">
                <div class="accordion-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6>Payrolls</h6>
                            <table class="table table-sm table-striped">
                                <thead><tr><th>Emp ID</th><th>Date</th><th>Amount</th><th>Bonus</th><th>Ded</th></tr></thead>
                                <tbody>
                                    @foreach (var p in Model.payrolls)
                                    {
                                        <tr><td>@p.EmpId</td><td>@p.PaymentDate</td><td>@p.FinalSalaryAmount</td><td>@p.BonusAmount</td><td>@p.DeductionsAmount</td></tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                        <div class="col-md-6">
                            <h6>Deductions</h6>
                            <table class="table table-sm table-striped">
                                <thead><tr><th>Emp ID</th><th>Date</th><th>Amount</th><th>Type</th><th>Status</th></tr></thead>
                                <tbody>
                                    @foreach (var d in Model.deductions)
                                    {
                                        <tr><td>@d.EmpId</td><td>@d.Date</td><td>@d.Amount</td><td>@d.Type</td><td>@d.Status</td></tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 7. PERFORMANCE -->
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingPerf">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapsePerf">
                    Performance Records (@Model.performances.Count records)
                </button>
            </h2>
            <div id="collapsePerf" class="accordion-collapse collapse" aria-labelledby="headingPerf" data-bs-parent="#dbAccordion">
                <div class="accordion-body">
                    <table class="table table-sm table-striped">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Emp ID</th>
                                <th>Semester</th>
                                <th>Rating</th>
                                <th>Comments</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model.performances)
                            {
                                <tr>
                                    <td>@item.PerformanceId</td>
                                    <td>@item.EmpId</td>
                                    <td>@item.Semester</td>
                                    <td>@item.Rating</td>
                                    <td>@item.Comments</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- 3.5. HOLIDAYS (New Section) -->
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingHoliday">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseHoliday">
                    Official Holidays (@Model.holidays.Count records)
                </button>
            </h2>
            <div id="collapseHoliday" class="accordion-collapse collapse" aria-labelledby="headingHoliday" data-bs-parent="#dbAccordion">
                <div class="accordion-body">
                    <table class="table table-sm table-striped">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>From Date</th>
                                <th>To Date</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model.holidays)
                            {
                                <tr>
                                    <!-- Adjust property names based on your Model (e.g. HolidayName vs Name) -->
                                    <td>@item.holiday_name</td>
                                    <td>@item.from_date</td>
                                    <td>@item.to_date</td>
                                </tr>
                            }
                            @if (Model.holidays.Count == 0)
                            {
                                <tr><td colspan="3" class="text-muted text-center">No holidays found.</td></tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

    </div>
</div>